<!doctype html>
<html lang="ja">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>摂取カロリー簡易計算 + PFC</title>

  <!-- Tailwind（CDN版 / 簡易スタイル用） -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React 18 + ReactDOM（UMD） -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel（ブラウザでJSXを変換） -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <body class="min-h-screen bg-gradient-to-b from-white to-emerald-50 text-gray-900 p-6">
    <div id="root"></div>

    <script type="text/babel">
      // ==== ここからアカリのReactロジック（importは使わない） ====
      const { useMemo, useState } = React;

      // 基礎代謝基準値（女性30-49歳） kcal/kg/日
      const BASAL_PER_KG_FEMALE_30_49 = 21.7;

      const ACTIVITY_LEVELS = [
        { key: 1.5, label: "低い（ほぼ運動なし）" },
        { key: 1.75, label: "普通（中程度の運動）" },
        { key: 2.0, label: "高い（激しい運動）" },
      ];

      const PFC_RATIO = { p: 15, f: 25, c: 60 }; // %
      const KCAL_PER_G = { p: 4, f: 9, c: 3.75 };

      function calcMaintainCalories({ weight, activity }) {
        return Math.round(BASAL_PER_KG_FEMALE_30_49 * weight * activity);
      }

      function calcDietCalories({ weight, height, age, activity }) {
        const BMR = 10 * weight + 6.25 * height - 5 * age - 161;
        const TDEE = BMR * activity;
        return Math.round(TDEE * 0.9);
      }

      function calcPFCFromKcal(totalKcal) {
        const pKcal = Math.round((totalKcal * PFC_RATIO.p) / 100);
        const fKcal = Math.round((totalKcal * PFC_RATIO.f) / 100);
        const cKcal = Math.round((totalKcal * PFC_RATIO.c) / 100);
        const pG = Math.round(pKcal / KCAL_PER_G.p);
        const fG = Math.round(fKcal / KCAL_PER_G.f);
        const cG = Math.round(cKcal / KCAL_PER_G.c);
        return { pKcal, fKcal, cKcal, pG, fG, cG };
      }

      function PFCApp() {
        const [form, setForm] = useState({
          weight: 50,
          height: 155,
          age: 33,
          activity: 1.75,
        });

        const bmi = useMemo(() => {
          if (!form.height || !form.weight) return "";
          const h = form.height / 100;
          return (form.weight / (h * h)).toFixed(1);
        }, [form.height, form.weight]);

        const maintain = useMemo(
          () => calcMaintainCalories({ weight: form.weight, activity: form.activity }),
          [form.weight, form.activity]
        );
        const diet = useMemo(() => calcDietCalories(form), [form]);

        const pfcMaintain = useMemo(() => calcPFCFromKcal(maintain), [maintain]);
        const pfcDiet = useMemo(() => calcPFCFromKcal(diet), [diet]);

        return (
          <div className="max-w-xl mx-auto bg-white rounded-2xl shadow p-6 space-y-4">
            <h1 className="text-2xl font-bold mb-4">摂取カロリー簡易計算</h1>

            {/* 入力 */}
            <div className="grid gap-3 mb-6 text-sm">
              <label className="flex flex-col">
                身長(cm)
                <input type="number" value={form.height}
                  onChange={(e)=>setForm({...form, height: +e.target.value})}
                  className="border rounded px-2 py-1" />
              </label>
              <label className="flex flex-col">
                体重(kg)
                <input type="number" value={form.weight}
                  onChange={(e)=>setForm({...form, weight: +e.target.value})}
                  className="border rounded px-2 py-1" />
              </label>
              <div className="flex flex-col">
                <span>BMI</span>
                <div className="border rounded px-2 py-1 bg-gray-100">{bmi}</div>
                {bmi && parseFloat(bmi) < 18.5 && (
                  <div className="mt-1 text-xs text-red-600">
                    WHOや日本の厚労省でも BMI&lt;18.5 は「低体重＝健康リスク」としているためおすすめしません。
                  </div>
                )}
              </div>
              <label className="flex flex-col">
                年齢
                <input type="number" value={form.age}
                  onChange={(e)=>setForm({...form, age: +e.target.value})}
                  className="border rounded px-2 py-1" />
              </label>
              <label className="flex flex-col">
                活動レベル
                <select value={form.activity}
                  onChange={(e)=>setForm({...form, activity: +e.target.value})}
                  className="border rounded px-2 py-1">
                  {ACTIVITY_LEVELS.map(l => (
                    <option key={l.key} value={l.key}>{l.label}</option>
                  ))}
                </select>
              </label>
            </div>

            {/* 結果 */}
            <div className="bg-emerald-50 rounded-xl p-4 space-y-2">
              <div className="font-semibold">あなたの1日の目安</div>
              <div>🔹 不調改善・体重維持に必要な摂取カロリー: <span className="font-bold">{maintain} kcal</span></div>
              <div>🔹 ダイエット用の摂取カロリー: <span className="font-bold">{diet} kcal</span></div>
            </div>

            {/* PFC（維持） */}
            <div className="rounded-xl border p-4 space-y-2">
              <div className="font-semibold">PFCバランスの計算（維持: {maintain} kcal 基準）</div>
              <div className="text-sm text-gray-600">P{PFC_RATIO.p}% / F{PFC_RATIO.f}% / C{PFC_RATIO.c}%（P1g×4kcal, F1g×9kcal, C1g×3.75kcal）</div>
              <div className="grid grid-cols-3 gap-2 text-center text-sm">
                <div className="p-3 rounded-xl border">
                  <div className="text-xs text-gray-600">P</div>
                  <div className="text-lg font-semibold">{pfcMaintain.pG} g</div>
                  <div className="text-xs text-gray-500">{pfcMaintain.pKcal} kcal</div>
                </div>
                <div className="p-3 rounded-xl border">
                  <div className="text-xs text-gray-600">F</div>
                  <div className="text-lg font-semibold">{pfcMaintain.fG} g</div>
                  <div className="text-xs text-gray-500">{pfcMaintain.fKcal} kcal</div>
                </div>
                <div className="p-3 rounded-xl border">
                  <div className="text-xs text-gray-600">C</div>
                  <div className="text-lg font-semibold">{pfcMaintain.cG} g</div>
                  <div className="text-xs text-gray-500">{pfcMaintain.cKcal} kcal</div>
                </div>
              </div>
            </div>

            {/* PFC（ダイエット） */}
            <div className="rounded-xl border p-4 space-y-2">
              <div className="font-semibold">PFCバランスの計算（ダイエット: {diet} kcal 基準）</div>
              <div className="text-sm text-gray-600">P{PFC_RATIO.p}% / F{PFC_RATIO.f}% / C{PFC_RATIO.c}%（P1g×4kcal, F1g×9kcal, C1g×3.75kcal）</div>
              <div className="grid grid-cols-3 gap-2 text-center text-sm">
                <div className="p-3 rounded-xl border">
                  <div className="text-xs text-gray-600">P</div>
                  <div className="text-lg font-semibold">{pfcDiet.pG} g</div>
                  <div className="text-xs text-gray-500">{pfcDiet.pKcal} kcal</div>
                </div>
                <div className="p-3 rounded-xl border">
                  <div className="text-xs text-gray-600">F</div>
                  <div className="text-lg font-semibold">{pfcDiet.fG} g</div>
                  <div className="text-xs text-gray-500">{pfcDiet.fKcal} kcal</div>
                </div>
                <div className="p-3 rounded-xl border">
                  <div className="text-xs text-gray-600">C</div>
                  <div className="text-lg font-semibold">{pfcDiet.cG} g</div>
                  <div className="text-xs text-gray-500">{pfcDiet.cKcal} kcal</div>
                </div>
              </div>
            </div>

            <div className="text-[11px] text-gray-500">
              ※ このツールは目安を示すもので医療行為ではありません。体調に不安がある場合は医療機関や専門家にご相談ください。
            </div>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<PFCApp />);
      // ==== ここまで ====
    </script>
  </body>
</html>

